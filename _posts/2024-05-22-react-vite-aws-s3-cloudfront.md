---
layout: custom-post
title:  "React+Vite 프로젝트, AWS S3와 CloudFront로 완벽 배포 가이드"
date:   2024-05-22
---

Vite 기반의 React 프로젝트를 빌드하여 AWS의 S3와 CloudFront를 통해 전 세계 사용자들에게 빠르고 안전하게 전달하는 과정을 A부터 Z까지 상세히 알아보겠습니다.

---

### 왜 S3 + CloudFront 조합인가?

- **비용 효율성**: 별도의 웹 서버(EC2 등) 없이 정적 파일을 호스팅하므로 매우 저렴합니다.
- **확장성**: AWS의 관리형 서비스이므로 트래픽 급증에도 자동으로 대응합니다.
- **성능**: CloudFront라는 CDN을 통해 전 세계 어디서든 사용자에게 가장 가까운 서버에서 콘텐츠를 전송하여 로딩 속도를 극대화합니다.
- **보안**: S3 버킷 직접 접근을 차단하고 CloudFront를 통해서만 통신하도록 구성하여 보안을 강화할 수 있습니다.

---

### Step 1: Vite + React 프로젝트 생성 및 빌드

먼저 배포할 React 프로젝트를 준비합니다. Vite는 놀랍도록 빠른 개발 서버와 최적화된 빌드 성능을 제공하여 현재 가장 인기있는 선택지 중 하나입니다.

```bash
# Vite를 이용해 React 프로젝트 생성
npm create vite@latest my-react-app -- --template react

# 프로젝트 폴더로 이동
cd my-react-app

# 의존성 설치
npm install

# 배포용 파일 빌드
npm run build
```

`npm run build` 명령을 실행하면, 프로젝트 루트에 `dist` 폴더가 생성됩니다. 이 폴더 안에는 압축되고 최적화된 HTML, CSS, JavaScript 파일들이 들어있으며, 이 결과물들을 S3에 업로드하게 됩니다.

---

### Step 2: AWS S3 버킷 생성 및 설정

이제 빌드된 정적 파일들을 담을 S3 버킷을 생성합니다. S3는 '정적 웹 사이트 호스팅' 기능을 제공합니다.

1.  **AWS Management Console**에 로그인 후 S3 서비스로 이동합니다.
2.  **[버킷 만들기]**를 클릭합니다.
3.  **버킷 이름**: 전역적으로 고유해야 합니다. (예: `my-vite-react-app-2024`)
4.  **AWS 리전**: 주 사용자가 위치한 곳과 가까운 리전을 선택합니다. (예: `ap-northeast-2` 서울)
5.  **퍼블릭 액세스 차단 설정**: **"모든 퍼블릭 액세스 차단"의 체크를 해제**하고, 경고 메시지를 확인합니다. CloudFront를 통해 배포할 것이지만, 우선 버킷 자체의 웹 호스팅 기능을 확인하기 위함입니다.
6.  나머지 옵션은 기본값으로 두고 **[버킷 만들기]**를 완료합니다.
7.  생성된 버킷의 **[속성]** 탭으로 이동하여 맨 아래 **[정적 웹 사이트 호스팅]** 섹션에서 **[편집]**을 누릅니다.
8.  **활성화**를 선택하고, **인덱스 문서**에 `index.html`을 입력한 후 변경 사항을 저장합니다.

---

### Step 3: 빌드 결과물을 S3에 업로드

`dist` 폴더의 내용물을 방금 생성한 S3 버킷에 업로드합니다.

**방법 1: AWS 콘솔에서 직접 업로드 (초심자용)**

- S3 버킷 페이지에서 **[업로드]** 버튼을 클릭하고 `dist` 폴더 안의 모든 파일과 폴더를 끌어다 놓습니다.

**방법 2: AWS CLI 사용 (권장)**

개발/배포 파이프라인을 자동화하려면 AWS CLI(Command Line Interface) 사용이 필수적입니다.

```bash
# dist 폴더의 내용을 S3 버킷에 동기화합니다.
# --delete 옵션은 S3에만 있고 로컬에는 없는 파일을 삭제하여 항상 동일한 상태를 유지합니다.
aws s3 sync dist/ s3://YOUR_BUCKET_NAME --delete
```

> **[실무 Tip]** CI/CD 파이프라인(GitHub Actions, Jenkins 등)을 구축할 때 이 `aws s3 sync` 명령어를 사용하면 배포 과정을 자동화할 수 있습니다.

---

### Step 4: CloudFront로 CDN 설정하기

이제 CloudFront를 설정하여 S3 버킷의 콘텐츠를 전 세계 사용자에게 빠르게 배포하고 보안을 강화할 차례입니다.

1.  **AWS CloudFront 서비스**로 이동하여 **[배포 생성]**을 클릭합니다.
2.  **원본 도메인**: 드롭다운 목록에서 방금 생성한 S3 버킷을 선택합니다.
3.  **원본 액세스**: **"Origin access control settings(recommended)"**를 선택하고 **[제어 설정 생성]**을 클릭합니다. 기본값으로 생성 후, CloudFront가 S3 버킷 정책을 업데이트하도록 제안하면 **"Copy policy"** 후 **"Go to S3 bucket permissions"** 를 눌러 버킷 정책에 붙여넣기 합니다. 이렇게 하면 사용자가 S3 URL로 직접 접근하는 것을 막고 CloudFront를 통해서만 콘텐츠에 접근하게 되어 보안이 강화됩니다.
4.  **뷰어 프로토콜 정책**: **"Redirect HTTP to HTTPS"**를 선택하여 모든 사용자가 보안 연결(HTTPS)을 사용하도록 강제합니다.
5.  **기본값 루트 객체**: `index.html`을 입력합니다. 사용자가 도메인 루트(`https://your-dist-id.cloudfront.net`)로 접속했을 때 보여줄 파일입니다.
6.  **[배포 생성]**을 클릭합니다. 배포가 완료되기까지 몇 분 정도 소요될 수 있습니다.

배포가 완료되면 CloudFront가 제공하는 도메인 이름으로 접속하여 앱이 잘 보이는지 확인합니다.

---

### Step 5: 클라이언트 사이드 라우팅 문제 해결 (가장 중요!)

React Router와 같은 라이브러리를 사용하면 심각한 문제에 부딪히게 됩니다. 메인 페이지(`https://.../`)는 잘 보이지만, 내부 페이지(`/about`, `/users/1`)의 URL로 직접 접속하면 S3가 해당 경로에 파일이 없다고 판단하여 **403 Forbidden** 또는 **404 Not Found** 에러를 반환합니다.

이는 S3가 정적 파일 서버로서의 역할만 하기 때문입니다. `/about`이라는 파일이나 폴더는 실제로 존재하지 않죠.

**해결책: CloudFront 에러 페이지 설정**

CloudFront가 이 에러를 가로채서 항상 `index.html`을 대신 보여주도록 설정하면, React Router가 브라우저에서 올바른 페이지를 렌더링할 수 있게 됩니다.

1.  생성한 CloudFront 배포의 **[오류 페이지]** 탭으로 이동합니다.
2.  **[사용자 정의 오류 응답 생성]**을 클릭합니다.
3.  **HTTP 오류 코드**: `403: Forbidden`을 선택합니다.
4.  **오류 응답 사용자 정의**: **'예'**를 선택합니다.
5.  **응답 페이지 경로**: `/index.html`을 입력합니다.
6.  **HTTP 응답 코드**: **`200: OK`**를 선택합니다.
7.  **[생성]** 버튼을 누릅니다.
8.  위 과정을 **`404: Not Found`** 오류 코드에 대해서도 동일하게 반복합니다.

이제 어떤 경로로 직접 접속하더라도 CloudFront는 `index.html`을 서빙하고, React 앱이 로드된 후 React Router가 주소창의 경로를 분석하여 올바른 컴포넌트를 보여주게 됩니다.

---

### 자주 겪는 이슈와 해결책 (Troubleshooting)

-   **캐시 문제**: 새 버전을 배포했는데도 이전 내용이 계속 보인다면 CloudFront 캐시 때문일 확률이 높습니다.
    -   **해결**: CloudFront 배포의 **[무효화]** 탭에서 `/*` 경로에 대한 무효화(Invalidation)를 생성하여 캐시를 강제로 삭제할 수 있습니다.
-   **IAM 권한**: CI/CD 파이프라인에 사용할 AWS 자격증명은 최소한의 권한만 가져야 합니다.
    -   **필요 권한**: `s3:PutObject`, `s3:ListBucket`, `s3:DeleteObject`, `s3:GetObject` (S3 동기화를 위해) / `cloudfront:CreateInvalidation` (캐시 무효화를 위해)
-   **Vite 환경변수**: `.env` 파일에 정의한 변수는 반드시 `VITE_` 접두사로 시작해야 빌드 결과물에 포함됩니다. (예: `VITE_API_URL`)
    -   **주의!**: 여기에 포함된 변수는 클라이언트 측 코드에 그대로 노출되므로, API 키와 같은 비밀 정보는 절대 포함해서는 안 됩니다.

---

### 마치며

이제 여러분은 Vite 기반의 React 프로젝트를 AWS의 강력한 인프라 위에 배포하는 현대적인 방법을 익혔습니다. 이 서버리스 아키텍처는 초기 스타트업부터 대규모 서비스까지 모두에게 적합한, 확장 가능하고 안정적이며 비용 효율적인 솔루션입니다.

여기서 더 나아가 Route53을 이용해 개인 도메인을 연결하고, AWS Certificate Manager(ACM)로 무료 SSL 인증서를 발급받으면 완벽한 프로덕션 환경을 갖추게 됩니다. 그 과정도 다음 기회에 다뤄보도록 하겠습니다. 